# For questions, and you want a human, reach out Chris.Rothwell@Optum.com with the EIS team. More information is
# available here: https://appsec.optum.com/docs/pullreq/
#
# Added via Firehose 1.1

name: "CodeQL"
on:
  ## By default, this is configured to the default branch.  There are many options as to what tag or
  ## action triggers the scan, which may be needed if you are doing a new default branch every sprint
  ## or some other workflow.
  ## https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows
  ## https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#filter-pattern-cheat-sheet
  ## https://michaelcurrin.github.io/dev-cheatsheets/cheatsheets/ci-cd/github-actions/triggers.html
  push:
    branches:
      - develop
      - master
      - main
      - releases/**
  pull_request:
    # Sequence of patterns matched against refs/heads
    branches:
      - develop
      - master
      - main
      - releases/**
jobs:
  analyze:
    name: Analyze ${{github.repository}} (${{matrix.language}})
    ## For C#/.NET projects, comment out the Linux 'runs on' and use Windows.  In most cases, the Linux boxes will be faster.
    runs-on: [ uhg-ghas, Linux, core-access ]
    #runs-on: [ uhg-ghas, Windows ]
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        # CodeQL supports [ 'cpp', 'csharp', 'go', 'java', 'javascript', 'python' ]
        # Learn more about CodeQL language support at https://aka.ms/codeql-docs/language-support
        language: [ 'java','javascript' ]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # If you need a specific version of Java, an LTS runtime can be targeted.
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin' # See 'Supported distributions' for available options
          java-version: '17'
          overwrite-settings: false

      # If you have a maven-wrapper in the project it will take precedence over this runner/system installed maven version.
      # Enable maven wrapper like: `mvn wrapper:wrapper -Dmaven=3.8.6`
      #
      # If you need a custom version of Maven (default is 3.8.x), it can be added here.
      # Available Versions: https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven
      #- name: Set up Maven
      #  uses: stCarolas/setup-maven@v4.5
      #  with:
      #    maven-version: 3.8.6

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: ${{ matrix.language }}
          queries: security-extended,security-and-quality

      - name: Autobuild
        uses: github/codeql-action/autobuild@v2

      # ‚úèÔ∏è If the Autobuild fails above, remove it and uncomment the following three lines
      #    and modify them (or add more) to build your code if your project
      #    uses a compiled language
      # ‚ÑπÔ∏è Command-line programs to run using the OS shell.
      # üìö See https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsrun
      #   If the Autobuild fails above, remove it and uncomment the following three lines.
      #   modify them (or add more) to build your code if your project, please refer to the EXAMPLE below for guidance.

      #- run: |
      #   make bootstrap
      #   make release
      # - run: |
      #   echo "Run, Build Application using script"
      #   ./location_of_script_within_repo/buildscript.

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2
